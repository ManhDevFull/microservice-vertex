; Supervisor base configuration for running the three ASP.NET Core services.
[supervisord]
nodaemon=true
logfile=/dev/null
pidfile=/tmp/supervisord.pid

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

; gRPC e-commerce core backend
[program:dotnet]
command=dotnet /app/dotnet/dotnet.dll
directory=/app/dotnet
autostart=true
autorestart=true
startretries=3
startsecs=5
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
stopasgroup=true
killasgroup=true
environment=DOTNET_GRPC="%(ENV_DOTNET_GRPC)s"

; Chat service gRPC host
[program:chat]
command=dotnet /app/chat/chat.dll
directory=/app/chat
autostart=true
autorestart=true
startretries=3
startsecs=5
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
stopasgroup=true
killasgroup=true
environment=CHAT_GRPC="%(ENV_CHAT_GRPC)s"

; Public API gateway (only port exposed on container)
[program:gateway]
command=dotnet /app/gateway/gateway.dll
directory=/app/gateway
autostart=true
autorestart=true
startretries=3
startsecs=5
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
stopasgroup=true
killasgroup=true
environment=DOTNET_GRPC="%(ENV_DOTNET_GRPC)s",CHAT_GRPC="%(ENV_CHAT_GRPC)s",PORT="%(ENV_PORT)s"
